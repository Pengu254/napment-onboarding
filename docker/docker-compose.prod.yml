services:
  frontend:
    build:
      context: ../frontend
      dockerfile: Dockerfile
      args:
        - VITE_WS_URL=wss://onboarding-api.bobbi.live/ws
        - VITE_API_URL=https://onboarding-api.bobbi.live
    container_name: onboarding-frontend
    restart: unless-stopped
    depends_on:
      - backend
    networks:
      - napment-network
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.onboarding-frontend.entrypoints=websecure"
      - "traefik.http.routers.onboarding-frontend.rule=Host(`onboarding.bobbi.live`)"
      - "traefik.http.routers.onboarding-frontend.tls.certresolver=letsencrypt"
      - "traefik.http.services.onboarding-frontend.loadbalancer.server.port=3001"

  backend:
    build:
      context: ../backend
      dockerfile: Dockerfile
    container_name: onboarding-backend
    restart: unless-stopped
    environment:
      - PORT=8001
      - FRONTEND_URL=https://onboarding.bobbi.live
      # Supabase
      - SUPABASE_URL=${SUPABASE_URL}
      - SUPABASE_SERVICE_KEY=${SUPABASE_SERVICE_KEY}
      # Shopify OAuth
      - SHOPIFY_CLIENT_ID=${SHOPIFY_CLIENT_ID}
      - SHOPIFY_CLIENT_SECRET=${SHOPIFY_CLIENT_SECRET}
      - OAUTH_CALLBACK_URL=https://onboarding-api.bobbi.live/auth/shopify/callback
    networks:
      - napment-network
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.onboarding-backend.entrypoints=websecure"
      - "traefik.http.routers.onboarding-backend.rule=Host(`onboarding-api.bobbi.live`)"
      - "traefik.http.routers.onboarding-backend.tls.certresolver=letsencrypt"
      - "traefik.http.services.onboarding-backend.loadbalancer.server.port=8001"

networks:
  napment-network:
    external: true
    name: napment-network
